<!DOCTYPE html>
<html>

<head>
    <title>TTCU</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Untitled</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Bitter:400,700">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="cssnew.css"> 
    <link rel="stylesheet" href="darkmode/moon.css">
    <link rel="stylesheet" href="../../../../src/css/showpost.css">
    <link rel=icon href="aa0r2-xtkx1.ico">


</head>

<body>


        <div class="grid-header">
    <div>
        <div class="header-dark">
            <div class="header" id="myHeader">  
                          <nav class="navbar navbar-dark navbar-expand-md navigation-clean-search">
                <div class="container"><img src="Icon.png"><a class="navbar-brand" href="#">TTCU </a>
                    
                
                    <button class="navbar-toggler" data-toggle="collapse" data-target="#navcol-1">
                        <span class="sr-only">Toggle navigation</span><span class="navbar-toggler-icon"></span></button>
                    <div class="collapse navbar-collapse" id="navcol-1">


                        <ul class="nav navbar-nav">
                            <li class="nav-item" role="presentation">  
                                <div class="moon" onclick="myFunction()" class= dark-mode ></div></li>

                            

                            <li class="nav-item" role="presentation"><a class="nav-link" href="../../../../public/index.html">خانه</a></li>
                            <li class="nav-item" role="presentation"><a class="nav-link" href="../../../about/about.html">درباره ما</a></li>

                            <li class="nav-item" role="presentation"><a class="nav-link" href="../../../blog/blogpage.html">بلاگ</a></li>

                            <li class="nav-item" role="presentation"><a class="nav-link" href="../../../contact-us/contact.html">ارتباط با ما</a></li>

                            <li class="dropdown"><a class="dropdown-toggle nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" href="#">مشاهده پست ها </a>
                                <div class="dropdown-menu" role="menu"><a class="dropdown-item" role="presentation" href="../../../postpage/showpost.html">منتخب برای شما</a><a class="dropdown-item" role="presentation" href="../../../postpage/showpost.html">جستجوی پست</a><a class="dropdown-item" role="presentation" href="#">Third Item</a></div>
                         

                            </li>
                        </ul>





                        <form class="form-inline mr-auto" target="_self">
                            <div class="form-group"><label for="search-field">
                                <i class="fa fa-search"></i></label>
                                <input class="form-control search-field" type="search" name="search" id="search-field"></div>


                        </form>
                        <span class="navbar-text">
                            <a href="../../../userinfo/userinfo.html" ><img src="img/per.PNG"></a>

                   </span>
                 
            </nav>
        </div>
    </div>
</div>
</div>

<div class="grid-container">
<div class="grid-img">

    <div class="row" style="align-content: center;">
        <div class="leftcolumn" id="posts">
        </div>
      
      
      
      
        <div class="rightcolumn">
      
          <div class="card" style="width:500px;text-align: center;">
            <h4>پیش نمایش پست ها</h4>
            <div class="fakeimg" id="top"></div>
          </div>
      
        </div>
    </div>
      
   
    <!---->
</form>
</div>
</div>

<script>
loadPosts();
function loadPosts(){
var detailArr={};
var xmlhttp;
if(window.XMLHttpRequest){
 xmlhttp=new XMLHttpRequest;
}
else{
    xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
}
xmlhttp.onreadystatechange=respond;
function respond (){
if (xmlhttp.readyState == 4 && xmlhttp.status == 200){
  
  var response = JSON.parse(this.responseText);
    if(response.code == 200){
        console.log(response);
        let len = response.object.length;
        let text ="";
        let images="";
        if(len==0)
        {
          text="<div class=\"card\"><h6>پستی برای نمایش وجود ندارد</h6></div>"
        }else
        {
        for (let i = 0; i < len; i++) {
          var randomPic=choosePic(response.object[i].postType);
             text += "<div id=\"post"+i+"\" class=\"card\">"+
              "<div class=\"btn-group\" >"+
        "<button type=\"button\" class=\"btn btn-danger dropdown-toggle\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">"+
          
        "</button>"+
        "<div class=\"dropdown-menu\">"+
     
          "<a class=\"dropdown-item\" href=\"#\">ویرایش</a>"+
          "<a  class=\"dropdown-item\" data-toggle=\"modal\" data-target=\"#exampleModalCenter\" >پاک کردن</a>"+
        "</div>"+
      "</div>"+
      "<br/>"+
                     "<h10>#" +convertPostType(response.object[i].postType) + "</h10>"+
                     "<h6 id=\"postId"+i+"\"> کد پست: "  + response.object[i].id +"</h6>"+
                     "<h6>"  + convertMajor(response.object[i].uniMajor.major) +"</h6>"+
                     "<h6>"  + convertUni(response.object[i].uniMajor.uni) +"</h6>" +
                     "<h2 id=\"textId"+i+"\"class=\"text\">"  + response.object[i].title +"</h2>" + 
                     "<h17>@" + response.object[i].username +"</h17>" +
                     "<h20>"  + convertUserType(response.object[i].userType) +"</h20>" +
                     "<div> <img  class=\"fakeimg\"   height='400' id='postImage' src='"+randomPic+"'> </div>" +
                     "<P class=\"text\">توضیحات:</P>" +
                     "<p class=\"text\">"  + response.object[i].description +"</p>" +
                     "<label class=\"text\"><p id=\"contact\">"+response.object[i].contact +"</p></label> "+
                     "<h6>تاریخ :"+response.object[i].pDate+"  "+response.object[i].pTime+"</h6></div>"+


                     "<!-- Modal -->"+
"<div class='modal fade' id='exampleModalCenter' tabindex='-1' role='dialog' aria-labelledby='exampleModalCenterTitle' aria-hidden='true'>"+
  "<div class='modal-dialog modal-dialog-centered' role='document'>"+
    "<div class='modal-content'>"+
      "<div class='modal-header' style='text-align: right;'>"+
        "<h5 class='modal-title' id='exampleModalCenterTitle'> حذف</h5>"+
        "<button type='button' class='close' data-dismiss='modal' aria-label='Close'>"+
          "<span aria-hidden='true'>&times;</span>"+
        "</button>"+
      "</div>"+
      "<div class='modal-body'>"+
        "<p style='text-align: right;'> آیا واقعاً می خواهید این پست را حذف کنید؟ این روند قابل برگشت نیست</p>"+
      "</div>"+
      "<div class='modal-footer'>"+
        "<button type='button' class='btn btn-secondary' data-dismiss='modal'>بستن </button>"+
        "<button type='button' class='btn btn-primary' onclick='deletePost(this)' id='card"+i+"' >حذف</button>"+
      "</div>"+
    "</div>"+
  "</div>"+
"</div>"+
                    "<!--modal--->";

              images+="<a href=\"#post"+i+"\">"+response.object[i].title+"</a><br>";
            
            }}
          
            document.getElementById("posts").innerHTML = text;
            document.getElementById("top").innerHTML = images;
            

     
    }else {
      window.location = 'welcome.html';

    }

}
else if( xmlhttp.status == 403){
    window.location = '../../../login/login.html';
  
  } 
else{
  console.log("Hello");

}

}


xmlhttp.open('GET','http://127.0.0.1:8082/api/userPostInquiry',true);
xmlhttp.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');
xmlhttp.setRequestHeader('Authorization',window.localStorage.getItem("Token"));

xmlhttp.send(JSON.stringify(detailArr));
}

</script>


<script>

  function deletePost(element){
  var cardId=element.getAttribute('id').replace('card','');
  
  var id = document.getElementById("postId"+cardId);

  var detailArr={};
  detailArr["id"]=id.innerHTML.replace(' کد پست:','');
  var xmlhttp;
  if(window.XMLHttpRequest){
   xmlhttp=new XMLHttpRequest;
  }
  else{
      xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
  }
  xmlhttp.onreadystatechange=respond;
  function respond (){
  if (xmlhttp.readyState == 4 && xmlhttp.status == 200){
    
    var response = JSON.parse(this.responseText);
      if(response.code == 200){
         
        loadPosts();
       
      }else {
        window.location = 'welcome.html';
  
      }
  
  }
  else if( xmlhttp.status == 403){
    window.location = 'login.html';
  
  }
  
  else{
    console.log("Hello");
  
  }
  
  }
  
  
  xmlhttp.open('POST','http://127.0.0.1:8082/api/postDelete',true);
  xmlhttp.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');
  xmlhttp.setRequestHeader('Authorization',window.localStorage.getItem("Token"));
  
  xmlhttp.send(JSON.stringify(detailArr));
  }


  
  </script>


  <script>
 

    var myPix = new Array("1.jpg","2.jpg","3.jpg","4.jpg");

    function choosePic(postType) {
     var randomNum = Math.floor(Math.random() * myPix.length);
     return "../../../../src/img/post/"+postType+"/"+ myPix[randomNum];
    }
  </script>

    <script src="makepost.js"></script>
    <script src="../../../../src/app/enumConverter.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="darkmode/darkmod.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.bundle.min.js"></script>
    <script src="../../../postpage/deletePost.js"></script>
    <!----->
</body>

</html>