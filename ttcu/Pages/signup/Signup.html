
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet"   href="signup.css">
  <link rel="stylesheet"   href="../../src/css/modal.css">
  <link rel="stylesheet"   href="select-option.css">
  <link rel=icon  href="16X16.ico" >
  <link rel=icon href="../../src/Logo/ttcu-icon.ico">


  <title> ثبت نام </title>
</head>
<body>
  
  <div id="container">
    <div id="left"> </div>

    <div id="right">

      <p class="signup">ثبت نام</p>

       <a href="../Login/login.html"><p id="link">یا ورود</p></a>


      
<form action="" method="POST" >


<input type="text"  placeholder="نام خود را وارد کنید" name="fname" id="fName" class="client-info"  autocomplete="off" required="required" dir="rtl">


<input type="text"  placeholder="نام خانوادگی خود را وارد کنید " name="lname" id="lName" class="client-info"   autocomplete="off" required="required" dir="rtl" >

<input type=text name="username"  id="username" placeholder="نام کاربری خود را وارد کنید"  id="username" class="client-info"  autocomplete="off" required="required" dir="rtl">



<div class="container">
    <input type="password" name="password" id="password" placeholder="گذرواژه" class="client-info"  autocomplete="off"  dir="rtl" />
    <i class="bi bi-eye-slash" id="togglePassword"></i>
</div>






<!--<p><input type="checkbox" onclick="myFunction()" class="checkbox" >Show Password</p> <br>-->

<label class="select" for="slct">
  <select id="userType" required="required" name="Usertypes" dir="rtl">
    <option value="" disabled="disabled" selected="selected">نوع کاربر را انتخاب کنید</option>
    <option value="ADMIN">مدیر گروه</option>
    <option value="MASTER">مدیر </option>
    <option value="TEACHER">استاد</option>
    <option value="STUDENT">دانشجو</option>
  </select>
  <svg>
    <use xlink:href="#select-arrow-down"></use>
  </svg>
</label>





<label class="select" for="uni">
  <select id="uni" required="required" name="University" dir="rtl">
    <option value="" disabled="disabled" selected="selected">دانشگاه خود را انتخاب کنید</option>
    <option value="SHARIATY_TECHNICAL_COLLEGE">دانشکده فنی دکتر شریعتی</option>
    <option value="VALIASR_TECHNICAL_COLLEGE"> دانشکده فنی ولیعصر</option>
    <option value="ENGHELAB_TECHNICAL_COLLEGE">دانشکده فنی انقلاب اسلامی</option>
    <option value="SHAMSIPOUR_TECHNICAL_COLLEGE">دانشکده فنی شمسی پور</option>

  </select>
  <svg>
    <use xlink:href="#select-arrow-down"></use>
  </svg>
</label>




<label class="select" for="major" >
  <select id="major" required="required" name="UniversityMajor" dir="rtl" >
    <option value="" disabled="disabled" selected="selected">رشته خود را انتخاب کنید</option>
    <option value="SOFTWARE">نرم افزار</option>
    <option value="ELECTRONICS">الکترونیک</option>
    <option value="MECHANICS">مکانیک</option>
    <option value="ICT">ICT</option>
   <option value="ARCHITECTURE">نقشه کشی معماری</option>   
   <option value="GRAPHICS">گرافیک</option>
   <option value="ACCOUNTING">حسابداری</option>
   <option value="CLOTHING_DESIGN">طراحی دوخت</option>
   <option value="PHYSICAL_EDUCATION">تربیت بدنی</option>
   <option value="IT">IT</option>
  </select>
  <svg>
    <use xlink:href="#select-arrow-down"></use>
  </svg>
</label>
<input type="button" id="submit" class="client-info" onclick="signUp()" value="ثبت">
<a href="../../public/index.html" ><p class="linkhome" >بازگشت به خانه</p> </a>   

<!-- SVG Sprites-->
<svg class="sprites">
  <symbol id="select-arrow-down" viewbox="0 0 10 6">
    <polyline points="1 1 5 5 9 1"></polyline>
  </symbol>
</svg>

  </div>


</form>
    </div>
  </div>
  <div class="join">
    <button id="modalbtn" class="btn btn-join" style="visibility: hidden;">
      ورود
      </button>
</div>
  <div class="overlay">
    <div class="modal__locked">
      <div class="modal-body">
        <center>
          <strong>ثبت نام با موفقیت انجام شد</strong>
          
          <h4>
              لطفا اطلاعات زیر را برای ورود به سیستم حفظ کنید
          </h4>
          <h5 id="signedUpUser"> <script>document.getElementById("username").value</script></h5>
          <h5 id="signedUpPass">رمز عبور : <script>document.getElementById("password").value</script></h5>
          <h5 id="signedUpType">نوع کاربر: <script>document.getElementById("userType").value</script></h5>

        </center>
      </div>
      <div class="modal-buttons">
        <button class="btn btn-footer btn-purple">بستن</button>
      </div>
    </div>
</div> 
  <script>
    
    function signUp(){
    var detailArr={};

    var uniMajor={};
    uniMajor["uni"]=document.getElementById("uni").value;
    uniMajor["major"]=document.getElementById("major").value;

    detailArr["username"]=document.getElementById("username").value;
    detailArr["password"]=document.getElementById("password").value;
    detailArr["fName"]=document.getElementById("fName").value;
    detailArr["lName"]=document.getElementById("lName").value;
    detailArr["userType"]=[document.getElementById("userType").value];
    detailArr["uniMajor"]=uniMajor;
  

   var detailArrstr=JSON.stringify(detailArr);
   console.log(detailArrstr);
    var xmlhttp;
    if(window.XMLHttpRequest){
     xmlhttp=new XMLHttpRequest;
    }
    else{
        xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
    }
xmlhttp.onreadystatechange=respond;
function respond (){

    if (xmlhttp.readyState == 4 && xmlhttp.status == 200){
      
      var resonse = JSON.parse(this.responseText);
        if(resonse.code == 200){
          document.getElementById("signedUpUser").innerText=detailArr["username"]+" :نام کاربری";
          document.getElementById("signedUpPass").innerText=detailArr["password"]+" :رمز عبور ";
          document.getElementById("signedUpType").innerText="نوع کاربری: "+convertUserType(document.getElementById("userType").value);

          document.getElementById("modalbtn").click();
        }else {
          window.location = 'welcome.html';

        }

    }

    else{
      console.log("Hello");

    }
  
}


xmlhttp.open('POST','http://127.0.0.1:8082/auth/signUp',true);
xmlhttp.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');
xmlhttp.setRequestHeader('Authorization',window.localStorage.getItem("Token"));

xmlhttp.send(detailArrstr);
}

  </script>


<script>
  loadUserInfo();
      function loadUserInfo(){
      var detailArr={};
      var xmlhttp;
      if(window.XMLHttpRequest){
       xmlhttp=new XMLHttpRequest;
      }
      else{
          xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
      }
      xmlhttp.onreadystatechange=respond;
      function respond (){
      
      if (xmlhttp.readyState == 4 && xmlhttp.status == 200){
        
        var response = JSON.parse(this.responseText);
          if(response.code == 200){
            
              var info = response.object;
              let userType=info.userType;
              if(userType!='ADMIN'&&userType!='MASTER')
              {
                window.location = '../Login/login.html';
              }
             
              
          
           
          }else {
            window.location = 'welcome.html';
      
          }
          }
      
      else if( xmlhttp.status == 403){
      window.location = '../Login/login.html';
    
    } else{
        console.log("Wait");
      
      }
      
      }
      
      
      xmlhttp.open('GET','http://127.0.0.1:8082/api/getUserInfo',true);
      xmlhttp.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');
      xmlhttp.setRequestHeader('Authorization',window.localStorage.getItem("Token"));
      
      xmlhttp.send(JSON.stringify(detailArr));
      }
      
      </script>
  <script src="signup.js"></script>
  <script src="../../src/app/enumConverter.js"></script>
  <script src="../../src/app/modal.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="app-signup.js"></script>
</body>
</html>

