<!DOCTYPE html>
<html>

<head>
    <title>TTCU</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Untitled</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Bitter:400,700">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="cssnew.css">
    <link rel="stylesheet" href="darkmode/moon.css">
   <link rel="stylesheet" href="../../../../src/css/showpost.css">
    <link rel=icon href="aa0r2-xtkx1.ico">


</head>

<body>


        <div class="grid-header">
    <div>
        <div class="header-dark">
            <div class="header" id="myHeader">  
                          <nav class="navbar navbar-dark navbar-expand-md navigation-clean-search">
                <div class="container"><img src="Icon.png"><a class="navbar-brand" href="#">TTCU </a>
                    
                
                    <button class="navbar-toggler" data-toggle="collapse" data-target="#navcol-1">
                        <span class="sr-only">Toggle navigation</span><span class="navbar-toggler-icon"></span></button>
                    <div class="collapse navbar-collapse" id="navcol-1">


                        <ul class="nav navbar-nav">
                            <li class="nav-item" role="presentation">  
                                <div class="moon" onclick="myFunction()" class= dark-mode ></div></li>

                            

                            <li class="nav-item" role="presentation"><a class="nav-link" href="index.html">Home</a></li>
                            <li class="nav-item" role="presentation"><a class="nav-link" href="#">About</a></li>

                            <li class="nav-item" role="presentation"><a class="nav-link" href="#">Blog</a></li>

                            <li class="nav-item" role="presentation"><a class="nav-link" href="#">Contact us</a></li>

                            <li class="dropdown"><a class="dropdown-toggle nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" href="#">Dropdown </a>
                                <div class="dropdown-menu" role="menu"><a class="dropdown-item" role="presentation" href="#">First Item</a><a class="dropdown-item" role="presentation" href="#">Second Item</a><a class="dropdown-item" role="presentation" href="#">Third Item</a></div>
                         

                            </li>
                        </ul>





                        <form class="form-inline mr-auto" target="_self">
                            <div class="form-group"><label for="search-field">
                                <i class="fa fa-search"></i></label>
                                <input class="form-control search-field" type="search" name="search" id="search-field"></div>


                        </form>
                        <span class="navbar-text">
                            <a href="../../../userinfo/userinfo.html" onclick="deletePost(this)" ><img src="img/per.PNG"></a>

                   </span>
                 
            </nav>
        </div>
    </div>
</div>
</div>

<div class="grid-container">
<div class="grid-img">

    <div class="row">
        <div class="leftcolumn" id="posts">
        </div>
      
      
      
      
        <div class="rightcolumn">
      
          <div class="card">
            <h3>Posts Review</h3>
            <div class="fakeimg" id="top"></div>
          </div>
      
        </div>
      </div>
      
   
    <!---->
</form>
</div>
</div>

<script>
loadPosts();
function loadPosts(){
var detailArr={};
var xmlhttp;
if(window.XMLHttpRequest){
 xmlhttp=new XMLHttpRequest;
}
else{
    xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
}
xmlhttp.onreadystatechange=respond;
function respond (){
if (xmlhttp.readyState == 4 && xmlhttp.status == 200){
  
  var response = JSON.parse(this.responseText);
    if(response.code == 200){
        console.log(response);
        let len = response.object.length;
        let text ="";
        let images="";
        for (let i = 0; i < len; i++) {
             text += "<div class=\"card\">"+
            "<ul>"+
              "<li class=\"dropdown\"><a class=\"dropdown-toggle nav-link dropdown-toggle\" data-toggle=\"dropdown\" aria-expanded=\"false\" href=\"#\"> </a>"+
                "<div  class=\"dropdown-menu\" role=\"menu\"><a id=\"card"+i+"\" class=\"dropdown-item\" role=\"presentation\" onclick=\"deletePost(this)\"> پاک کردن</a>"+
                    "<a class=\"dropdown-item\" role=\"presentation\" href=\"#\"> ویرایش کردن </a>"+
                "</div>"+
              "</li>"+
            "</ul>"+
                     "<h10>#" + response.object[i].postType + "</h10>"+
                     "<h6 id=\"postId"+i+"\">"  + response.object[i].id +"</h6>"+
                     "<h6>"  + response.object[i].uniMajor.major +"</h6>"+
                     "<h6>"  + response.object[i].uniMajor.uni +"</h6>" +
                     "<h2 class=\"text\">"  + response.object[i].title +"</h2>" + 
                     "<h17>@" + response.object[i].username +"</h17>" +
                     "<h20>"  + response.object[i].userType +"</h20>" +
                     "<div class=\"fakeimg\" style=\"height:200px\">"  + response.object[i].image +"</div>" +
                     "<P class=\"text\">توضیحات:</P>" +
                     "<p class=\"text\">"  + response.object[i].description +"</p>" +
                     "<label class=\"text\">تلفن:<p id=\"contact\">"+response.object[i].contact +"</p></label>" +
                     "<button class=\"button\">دانلود</button>";

              images+=response.object[i].image+"<br>";
            
            }
            console.log(text);
            document.getElementById("posts").innerHTML = text;
            document.getElementById("top").innerHTML = images;

     
    }else {
      window.location = 'welcome.html';

    }

}

else{
  console.log("Hello");

}

}


xmlhttp.open('GET','http://127.0.0.1:8082/api/userPostInquiry',true);
xmlhttp.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');
xmlhttp.setRequestHeader('Authorization',window.localStorage.getItem("Token"));

xmlhttp.send(JSON.stringify(detailArr));
}

</script>


<script>

  function deletePost(element){
  var cardId=element.getAttribute('id').replace('card','');
  
  var id = document.getElementById("postId"+cardId);

  var detailArr={};
  detailArr["id"]=id.innerHTML;
  var xmlhttp;
  if(window.XMLHttpRequest){
   xmlhttp=new XMLHttpRequest;
  }
  else{
      xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
  }
  xmlhttp.onreadystatechange=respond;
  function respond (){
  if (xmlhttp.readyState == 4 && xmlhttp.status == 200){
    
    var response = JSON.parse(this.responseText);
      if(response.code == 200){
         
        loadPosts();
       
      }else {
        window.location = 'welcome.html';
  
      }
  
  }
  
  else{
    console.log("Hello");
  
  }
  
  }
  
  
  xmlhttp.open('POST','http://127.0.0.1:8082/api/postDelete',true);
  xmlhttp.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');
  xmlhttp.setRequestHeader('Authorization',window.localStorage.getItem("Token"));
  
  xmlhttp.send(JSON.stringify(detailArr));
  }
  
  </script>

    <script src="makepost.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="darkmode/darkmod.js"></script>
       <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.bundle.min.js"></script>
    <!----->
</body>

</html>